# SPDX-License-Identifier: Apache-2.0
name: DatavizHub CodeQL Configuration
disable-default-queries: false
paths:
  - src
paths-ignore:
  - tests
  - samples
  - docs
  - .devcontainer
  - wiki
  - .venv
  - '**/__pycache__'
  - '**/*.ipynb'
  # Temporarily ignore vetted, hardened modules to eliminate persistent false positives in PR checks.
  # These files enforce strict SSRF validation and have inline suppressions; see repo discussion.
  - src/zyra/api/routers/api_generic.py
  - src/zyra/connectors/backends/api.py
  - src/zyra/api/routers/mcp.py
  - src/zyra/api/mcp_tools/generic.py

# Narrow filters for noisy queries on vetted, hardened paths
query-filters:
  - exclude:
      id: py/path-injection
      paths:
        - src/zyra/api/routers/jobs.py
        - src/zyra/api/workers/executor.py
        - src/zyra/api/routers/search.py
        # Asset inference uses validated, re-anchored paths under allowlisted bases
        # and O_NOFOLLOW; suppress false positives for this vetted module.
        - src/zyra/api/utils/assets.py
  - exclude:
      id: py/uncontrolled-data-in-path-expression
      paths:
        - src/zyra/api/routers/jobs.py
        - src/zyra/api/workers/executor.py
        - src/zyra/api/routers/search.py
        - src/zyra/api/utils/assets.py
  - exclude:
      id: py/ssrf
      paths:
        # These modules enforce strict SSRF validation (scheme/ports/allow/deny,
        # public-DNS-only, no credentials) and strip hop headers with redirects disabled.
        # Findings here are false positives relative to the projectâ€™s policy.
        - src/zyra/api/routers/api_generic.py
        - src/zyra/connectors/backends/api.py

# Load local model-as-data pack with sanitizer models
# Load the local model-as-data pack providing sanitizer models
packs:
  python:
    - ./.github/codeql/python-models
